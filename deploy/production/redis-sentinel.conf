# Redis Sentinel Configuration for DocCraft AI
# This file configures Redis Sentinel for high availability

# Sentinel port
port 26379

# Sentinel working directory
dir /tmp

# Sentinel monitor configuration
# Format: sentinel monitor <master-name> <ip> <redis-port> <quorum>
sentinel monitor mymaster redis 6379 2

# Sentinel down-after-milliseconds
# Time in milliseconds that a master is considered down
sentinel down-after-milliseconds mymaster 5000

# Sentinel parallel-syncs
# Number of replicas that can be reconfigured to use a new master simultaneously
sentinel parallel-syncs mymaster 1

# Sentinel failover-timeout
# Time in milliseconds that a failover operation should complete
sentinel failover-timeout mymaster 10000

# Sentinel auth-pass
# Password for Redis authentication
sentinel auth-pass mymaster ${REDIS_PASSWORD}

# Sentinel notification-script
# Script to run when a failover occurs
# sentinel notification-script mymaster /path/to/notification.sh

# Sentinel client-reconfig-script
# Script to run when a client reconfiguration occurs
# sentinel client-reconfig-script mymaster /path/to/reconfig.sh

# Logging
loglevel notice
logfile ""

# Daemonize
daemonize no

# PID file
pidfile /var/run/redis-sentinel.pid

# Protected mode
protected-mode no

# Bind address
bind 0.0.0.0

# TCP keepalive
tcp-keepalive 300

# Timeout
timeout 0

# TCP backlog
tcp-backlog 511

# Databases
databases 16

# Save configuration
save 900 1
save 300 10
save 60 10000

# Stop-writes-on-bgsave-error
stop-writes-on-bgsave-error yes

# RDB compression
rdbcompression yes

# RDB checksum
rdbchecksum yes

# Dump filename
dbfilename dump.rdb

# Working directory
dir ./

# Replica settings
replica-serve-stale-data yes
replica-read-only yes

# Replica priority
replica-priority 100

# Min replicas for writes
min-replicas-to-write 0
min-replicas-max-lag 10

# Replica authentication
# replicaauth <master-password>

# Max clients
maxclients 10000

# Max memory
maxmemory 2gb

# Max memory policy
maxmemory-policy allkeys-lru

# Append only file
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Lua time limit
lua-time-limit 5000

# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency monitor
latency-monitor-threshold 100

# Notify keyspace events
notify-keyspace-events ""

# Hash max ziplist entries
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List max ziplist entries
list-max-ziplist-size -2

# Set max intset entries
set-max-intset-entries 512

# Zset max ziplist entries
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# Hll sparse to dense
hll-sparse-max-bytes 3000

# Stream node max bytes
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active rehashing
activerehashing yes

# Client output buffer limit
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Client query buffer limit
client-query-buffer-limit 1gb

# Protocol max bulk length
proto-max-bulk-len 512mb

# Hz
hz 10

# Dynamic hz
dynamic-hz yes

# AOF rewrite incremental fsync
aof-rewrite-incremental-fsync yes

# RDB save incremental fsync
rdb-save-incremental-fsync yes

# LFU log factor
lfu-log-factor 10

# LFU decay time
lfu-decay-time 1
